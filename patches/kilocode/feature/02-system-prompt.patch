file packages/types/src/experiment.ts
label import type { Keys, Equals, AssertEqual } from "./type-fu.js"

  * ExperimentId
  */
 
-const kilocodeExperimentIds = ["morphFastApply", "speechToText"] as const // kilocode_change
+const kilocodeExperimentIds = ["rawSystemPrompt", "morphFastApply", "speechToText"] as const // kilocode_change
 export const experimentIds = [
 	"powerSteering",
 	"multiFileApplyDiff",

label export type ExperimentId = z.infer<typeof experimentIdsSchema>

  */
 
 export const experimentsSchema = z.object({
+	rawSystemPrompt: z.boolean().optional(),
 	morphFastApply: z.boolean().optional(), // kilocode_change
 	speechToText: z.boolean().optional(), // kilocode_change
 	powerSteering: z.boolean().optional(),

file src/core/prompts/sections/custom-system-prompt.ts
label function interpolatePromptContent(content: string, variables: PromptVariables):

 /**
  * Safely reads a file, returning an empty string if the file doesn't exist
  */
-async function safeReadFile(filePath: string): Promise<string> {
+export async function safeReadFile(filePath: string): Promise<string> {
 	try {
 		const content = await fs.readFile(filePath, "utf-8")
 		// When reading with "utf-8" encoding, content should be a string

file src/core/prompts/sections/skills.ts
label function escapeXml(value: string): string {

 		.replace(/'/g, "&apos;")
 }
 
+export function getSkills(
+  skillsManager: SkillsManagerLike | undefined,
+  currentMode: string | undefined
+): string {
+  if (!skillsManager || !currentMode) return '';
+
+  // Get skills filtered by current mode (with override resolution)
+  const skills = skillsManager.getSkillsForMode(currentMode);
+  if (skills.length === 0) return '';
+
+  const skillsXml = skills
+    .map((skill) => {
+      const name = escapeXml(skill.name);
+      const description = escapeXml(skill.description);
+      // Per the Agent Skills integration guidance for filesystem-based agents,
+      // location should be an absolute path to the SKILL.md file.
+      const location = escapeXml(skill.path);
+      return `  <skill>\n    <name>${name}</name>\n    <description>${description}</description>\n    <location>${location}</location>\n  </skill>`;
+    })
+    .join('\n');
+
+  return `<available_skills>\n${skillsXml}\n</available_skills>`;
+}
+
 /**
  * Generate the skills section for the system prompt.
  * Only includes skills relevant to the current mode.
  * Format matches the modes section style.
  *
  * @param skillsManager - The SkillsManager instance
  * @param currentMode - The current mode slug (e.g., 'code', 'architect')
  */
 export async function getSkillsSection(
 	skillsManager: SkillsManagerLike | undefined,
 	currentMode: string | undefined,
 ): Promise<string> {
-	if (!skillsManager || !currentMode) return ""
-
-	// Get skills filtered by current mode (with override resolution)
-	const skills = skillsManager.getSkillsForMode(currentMode)
-	if (skills.length === 0) return ""
-
-	const skillsXml = skills
-		.map((skill) => {
-			const name = escapeXml(skill.name)
-			const description = escapeXml(skill.description)
-			// Per the Agent Skills integration guidance for filesystem-based agents,
-			// location should be an absolute path to the SKILL.md file.
-			const location = escapeXml(skill.path)
-			return `  <skill>\n    <name>${name}</name>\n    <description>${description}</description>\n    <location>${location}</location>\n  </skill>`
-		})
-		.join("\n")
+  const skillsXml = getSkills(skillsManager, currentMode)
+  if (!skillsXml) return ""
 
 	return `====
 
 AVAILABLE SKILLS
 
-<available_skills>
 ${skillsXml}
-</available_skills>
 
 <mandatory_skill_check>
 REQUIRED PRECONDITION

file src/core/prompts/system.ts

+import osName from "os-name"
+import * as path from "path"
+import { getShell } from "../../utils/shell"
+import { isLanguage } from "@roo-code/types"
+import { LANGUAGES } from "../../shared/language"
+import { fileExistsAtPath } from "../../utils/fs"
+import { safeReadFile } from "./sections/custom-system-prompt"
+import { getSkills } from './sections/skills'
 import * as vscode from "vscode"
 import * as os from "os"
 

label export const SYSTEM_PROMPT = async (

 	const mode =
 		getModeBySlug(inputMode, customModes)?.slug || modes.find((m) => m.slug === inputMode)?.slug || defaultModeSlug // kilocode_change: don't try to use non-existent modes
 
+  if (experiments?.rawSystemPrompt) {
+    const systemPath = path.join(os.homedir(), ".kilocode", "systems")
+    const systemRolePath = path.join(systemPath, `role-${mode}.md`)
+
+    if (await fileExistsAtPath(systemRolePath)) {
+      const systemPrompt = (await Promise.all([
+        safeReadFile(systemRolePath),
+        safeReadFile(path.join(systemPath, "01-header.md")),
+        safeReadFile(path.join(systemPath, "02-body.md")),
+        safeReadFile(path.join(systemPath, "03-footer.md")),
+        safeReadFile(path.join(cwd, "agent.md")),
+        safeReadFile(path.join(cwd, "agents.md")),
+      ])).filter(Boolean).join("\n\n").trim()
+
+      const languageIso = language ?? formatLanguage(vscode.env.language)
+      const languageName = isLanguage(languageIso) ? LANGUAGES[languageIso] : languageIso
+      const terminal = getShell(clineProviderState?.terminalShellIntegrationDisabled)
+
+      return systemPrompt
+        .replaceAll("{{OPERATING}}", osName())
+        .replaceAll("{{TERMINAL}}", terminal.toPosix())
+        .replaceAll("{{HOMEDIR}}", os.homedir().toPosix())
+        .replaceAll("{{WORKDIR}}", cwd.toPosix())
+        .replaceAll("{{LANGUAGE}}", `${languageName} (${languageIso})`)
+        .replaceAll("{{CURRENT_MODE}}", mode)
+        .replaceAll("{{SKILL_LIST}}", getSkills(skillsManager, mode))
+    }
+  }
+
 	// Try to load custom system prompt from file
 	const variablesForPrompt: PromptVariables = {
 		workspace: cwd,

file src/shared/__tests__/experiments.spec.ts
label describe("experiments", () => {

 	describe("isEnabled", () => {
 		it("returns false when POWER_STEERING experiment is not enabled", () => {
 			const experiments: Record<ExperimentId, boolean> = {
+        rawSystemPrompt: false,
 				morphFastApply: false, // kilocode_change
 				speechToText: false, // kilocode_change
 				powerSteering: false,
 				multiFileApplyDiff: false,
 				preventFocusDisruption: false,
 				imageGeneration: false,
 				runSlashCommand: false,
 				multipleNativeToolCalls: false,
 				customTools: false,
 			}
 			expect(Experiments.isEnabled(experiments, EXPERIMENT_IDS.POWER_STEERING)).toBe(false)
 		})
 
 		it("returns true when experiment POWER_STEERING is enabled", () => {
 			const experiments: Record<ExperimentId, boolean> = {
+        rawSystemPrompt: false,
 				morphFastApply: false, // kilocode_change
 				speechToText: false, // kilocode_change
 				powerSteering: true,
 				multiFileApplyDiff: false,
 				preventFocusDisruption: false,
 				imageGeneration: false,
 				runSlashCommand: false,
 				multipleNativeToolCalls: false,
 				customTools: false,
 			}
 			expect(Experiments.isEnabled(experiments, EXPERIMENT_IDS.POWER_STEERING)).toBe(true)
 		})
 
 		it("returns false when experiment is not present", () => {
 			const experiments: Record<ExperimentId, boolean> = {
+        rawSystemPrompt: false,
 				morphFastApply: false, // kilocode_change
 				speechToText: false, // kilocode_change
 				powerSteering: false,

file src/shared/experiments.ts

 import type { AssertEqual, Equals, Keys, Values, ExperimentId, Experiments } from "@roo-code/types"
 
 export const EXPERIMENT_IDS = {
+	RAW_SYSTEM_PROMPT: "rawSystemPrompt",
 	MORPH_FAST_APPLY: "morphFastApply", // kilocode_change
 	SPEECH_TO_TEXT: "speechToText", // kilocode_change
 	MULTI_FILE_APPLY_DIFF: "multiFileApplyDiff",

label interface ExperimentConfig {

 }
 
 export const experimentConfigsMap: Record<ExperimentKey, ExperimentConfig> = {
+	RAW_SYSTEM_PROMPT: { enabled: false },
 	MORPH_FAST_APPLY: { enabled: false }, // kilocode_change
 	SPEECH_TO_TEXT: { enabled: true }, // kilocode_change
 	MULTI_FILE_APPLY_DIFF: { enabled: false },

file src/utils/shell.ts
label function getSafeFallbackShell(): string {

 // 5) Publicly Exposed Shell Getter
 // -----------------------------------------------------
 
-export function getShell(): string {
+export function getShell(terminalShellIntegrationDisabled?: boolean): string {
 	let shell: string | null = null
 
+  if (terminalShellIntegrationDisabled) {
+  	return process.platform === "win32" ? SHELL_PATHS.CMD : SHELL_PATHS.SH
+  }
+
 	// 1. Check VS Code config first.
 	if (process.platform === "win32") {
 		// Special logic for Windows

file webview-ui/src/components/settings/ExperimentalSettings.tsx

+import { VSCodeCheckbox } from "@vscode/webview-ui-toolkit/react"
 import React, { HTMLAttributes } from "react"
 
 import type { Experiments, ImageGenerationProvider } from "@roo-code/types"

label export const ExperimentalSettings = ({

 						const experimentKey = config[0]
 						const label = t(`settings:experimental.${experimentKey}.name`)
 
+            if (config[0] === "RAW_SYSTEM_PROMPT") {
+							return (
+								<SearchableSetting
+									key={config[0]}
+									settingId={`experimental-${config[0].toLowerCase()}`}
+									section="experimental"
+									label="Use raw system prompt">
+                  <div>
+                    <div className="flex items-center gap-2">
+                      <VSCodeCheckbox checked={experiments[EXPERIMENT_IDS.RAW_SYSTEM_PROMPT] ?? false} onChange={(e: any) => {
+                        setExperimentEnabled(EXPERIMENT_IDS.RAW_SYSTEM_PROMPT, e.target.checked)
+                      }}>
+                        <span className="font-medium">Use raw system prompt</span>
+                      </VSCodeCheckbox>
+                    </div>
+                    <p className="text-vscode-descriptionForeground text-sm mt-0">
+                      When enabled, Kilo Code will attempt to load the system prompt from ~/.kilocode/systems/ if it exists.
+                    </p>
+                  </div>
+								</SearchableSetting>
+							)
+						}
 						if (config[0] === "MULTI_FILE_APPLY_DIFF") {
 							return (
 								<SearchableSetting

file webview-ui/src/context/__tests__/ExtensionStateContext.spec.tsx
label describe("mergeExtensionState", () => {

 			...baseState,
 			apiConfiguration: { modelMaxThinkingTokens: 456, modelTemperature: 0.3 },
 			experiments: {
+        rawSystemPrompt: false,
 				powerSteering: true,
 				multiFileApplyDiff: true,
 				preventFocusDisruption: false,
